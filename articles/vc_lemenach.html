<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="exDE">
<title>ITN-based Vector Control • exDE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="ITN-based Vector Control">
<meta property="og:description" content="exDE">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">exDE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ex_534.html">5-3-4 Spatial Example</a>
    <a class="dropdown-item" href="../articles/spat_metric.html">Spatial Metrics</a>
    <a class="dropdown-item" href="../articles/vc_lemenach">Vector Control Example</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-adult-mosquito-component">Adult Mosquito Component</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-adult-mosquito-component">
    <a class="dropdown-item" href="../articles/adult_RM.html">Ross-Macdonald model</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-aquatic-mosquito-component">Aquatic Mosquito Component</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-aquatic-mosquito-component">
    <a class="dropdown-item" href="../articles/aqua_trace.html">Trace (forced) model</a>
    <a class="dropdown-item" href="../articles/aqua_basic.html">Basic competition model</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-human-component">Human Component</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-human-component">
    <a class="dropdown-item" href="../articles/human_sis.html">SIS model</a>
    <a class="dropdown-item" href="../articles/human_sip.html">SIP model</a>
    <a class="dropdown-item" href="../articles/human_hmoi.html">MoI hybrid model</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dd-harp/exDE/">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>ITN-based Vector Control</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/exDE/blob/HEAD/vignettes/vc_lemenach.Rmd" class="external-link"><code>vignettes/vc_lemenach.Rmd</code></a></small>
      <div class="d-none name"><code>vc_lemenach.Rmd</code></div>
    </div>

    
    
<p>In this vignette we demonstrate how to set up a model incorporating
the Le Menach model of ITN based vector control (see <a href="https://malariajournal.biomedcentral.com/articles/10.1186/1475-2875-6-10" class="external-link">this
paper</a>). We use the generalized Ross-Macdonald model of adult
mosquito dynamics, the SIS model of human population dynamics, and the
basic competition model of aquatic mosquito dynamics to fill the
dynamical components <span class="math inline">\(\mathcal{M},
\mathcal{X}, \mathcal{L}\)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dd-harp.github.io/exDE/">exDE</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://R-Forge.R-project.org/projects/expm/" class="external-link">expm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://desolve.r-forge.r-project.org/" class="external-link">deSolve</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h2>
<p>This case study will use a simple model with 3 patches, 3 population
strata, and 3 aquatic habitats. As usual, we set up parameter values and
compute the values of state variables at equilibrium. As part of the
equilibrium calculation we must compute <span class="math inline">\(\Upsilon(0) = \exp\left(-\int_{-\tau}^{0}
\Omega(s) ds \right)\)</span>; the value of the integrated mosquito
demography matrix at the initial time point. To simplify things, we
simply assume that conditions were constant prior to <span class="math inline">\(t=0\)</span> so that <span class="math inline">\(\Upsilon(0) = e^{-\Omega\tau}\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">pars</span><span class="op">$</span><span class="va">nStrata</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">pars</span><span class="op">$</span><span class="va">nHabitats</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span></span>
<span><span class="co"># human parameters</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">0.55</span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fl">0.15</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">200</span></span>
<span><span class="va">wf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">pars</span><span class="op">$</span><span class="va">nStrata</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pfpr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">nStrata</span>, min <span class="op">=</span> <span class="fl">0.25</span>, max <span class="op">=</span> <span class="fl">0.35</span><span class="op">)</span></span>
<span><span class="va">H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">nStrata</span>, lambda <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">nStrata</span>, size <span class="op">=</span> <span class="va">H</span>, prob <span class="op">=</span> <span class="va">pfpr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">0.9</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>,</span>
<span>    <span class="fl">0.05</span>, <span class="fl">0.9</span>, <span class="fl">0.05</span>,</span>
<span>    <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.9</span></span>
<span>  <span class="op">)</span>, nrow <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">nStrata</span>, ncol <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span>, byrow <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span><span class="va">Psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Psi</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># adult mosquito parameters</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fl">0.9</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">10</span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">100</span></span>
<span><span class="va">nu</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span></span>
<span><span class="va">eggsPerBatch</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">tau</span> <span class="op">&lt;-</span> <span class="fl">11</span></span>
<span></span>
<span><span class="co"># mosquito movement calK</span></span>
<span><span class="va">calK</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span>, <span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="va">calK</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">upper.tri</a></span><span class="op">(</span><span class="va">calK</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">calK</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">lower.tri</a></span><span class="op">(</span><span class="va">calK</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">calK</span> <span class="op">&lt;-</span> <span class="va">calK</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">calK</span><span class="op">)</span></span>
<span><span class="va">calK</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">calK</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Omega</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_Omega.html">make_Omega</a></span><span class="op">(</span>g <span class="op">=</span> <span class="va">g</span>, sigma <span class="op">=</span> <span class="va">sigma</span>, K <span class="op">=</span> <span class="va">calK</span>, nPatches <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="va">Omega_inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">Omega</span><span class="op">)</span></span>
<span><span class="va">Upsilon</span> <span class="op">&lt;-</span> <span class="fu">expm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/expm/man/expm.html" class="external-link">expm</a></span><span class="op">(</span><span class="op">-</span><span class="va">Omega</span> <span class="op">*</span> <span class="va">tau</span><span class="op">)</span></span>
<span><span class="va">Upsilon_inv</span> <span class="op">&lt;-</span> <span class="fu">expm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/expm/man/expm.html" class="external-link">expm</a></span><span class="op">(</span><span class="va">Omega</span> <span class="op">*</span> <span class="va">tau</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="equilibrium">Equilibrium<a class="anchor" aria-label="anchor" href="#equilibrium"></a>
</h2>
<p>Now we compute the equilibrium conditions for the adult mosquitoes
and human populations, such that the PfPR in the human population would
be maintained at the input levels if conditions were unchanging.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># derived EIR to sustain equilibrium pfpr</span></span>
<span><span class="va">EIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">b</span>, <span class="va">pars</span><span class="op">$</span><span class="va">nStrata</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="op">(</span><span class="va">r</span><span class="op">*</span><span class="va">X</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">H</span> <span class="op">-</span> <span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ambient pop</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="va">Psi</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">H</span></span>
<span></span>
<span><span class="co"># biting distribution matrix</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">wf</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Psi</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span>, <span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># kappa</span></span>
<span><span class="va">kappa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">X</span><span class="op">*</span><span class="va">c</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># equilibrium solutions</span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">f</span><span class="op">*</span><span class="va">q</span><span class="op">)</span>, <span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/ginv.html" class="external-link">ginv</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">EIR</span></span>
<span><span class="va">MY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">f</span><span class="op">*</span><span class="va">q</span><span class="op">*</span><span class="va">kappa</span><span class="op">)</span>, <span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Upsilon_inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Omega</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Z</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">Omega_inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">f</span><span class="op">*</span><span class="va">q</span><span class="op">*</span><span class="va">kappa</span><span class="op">)</span>, <span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">MY</span><span class="op">)</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="va">MY</span> <span class="op">+</span> <span class="va">Y</span></span>
<span><span class="va">G</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">nu</span><span class="op">+</span><span class="va">f</span>, <span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span> <span class="op">+</span> <span class="va">Omega</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">f</span>, <span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">M</span></span>
<span><span class="va">Lambda</span> <span class="op">&lt;-</span> <span class="va">Omega</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">M</span></span></code></pre></div>
<p>Given the equilibrium value of <span class="math inline">\(\Lambda\)</span> required to sustain mosquito
populations at such a level sufficient to maintain transmission at that
level of PfPR, as well as values for <span class="math inline">\(\psi\)</span> (maturation rate) and <span class="math inline">\(\phi\)</span> (density independent mortality), we
compute equilibrium values of <span class="math inline">\(L\)</span>
(aquatic mosquito density) and <span class="math inline">\(\theta\)</span> (density dependent mortality).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># aquatic habitat membership matrix (assume 1 habitat per patch)</span></span>
<span><span class="va">calN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span>, <span class="va">pars</span><span class="op">$</span><span class="va">nHabitats</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">calN</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># egg dispersal matrix (assume 1 habitat per patch)</span></span>
<span><span class="va">calU</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">pars</span><span class="op">$</span><span class="va">nHabitats</span>, <span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">calU</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">calN</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Lambda</span><span class="op">)</span></span>
<span></span>
<span><span class="va">psi</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">10</span></span>
<span><span class="va">phi</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">12</span></span>
<span><span class="va">eta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">calU</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">G</span> <span class="op">*</span> <span class="va">nu</span> <span class="op">*</span> <span class="va">eggsPerBatch</span><span class="op">)</span></span>
<span></span>
<span><span class="va">L</span> <span class="op">&lt;-</span> <span class="va">alpha</span><span class="op">/</span><span class="va">psi</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">eta</span> <span class="op">-</span> <span class="va">psi</span><span class="op">*</span><span class="va">L</span> <span class="op">-</span> <span class="va">phi</span><span class="op">*</span><span class="va">L</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">L</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Now that all state variables have been solved at equilibrium, we can
set up the parameters and components of the system. We also need to set
up a time-varying function to compute the coverage of ITNs at any time
point. We use a sine curve with a period of 365 days which goes from 0
to 1 over that period. This must be a function that takes a single
argument <code>t</code> (time) and returns a scalar value.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pars</span><span class="op">$</span><span class="va">calU</span> <span class="op">&lt;-</span> <span class="va">calU</span></span>
<span><span class="va">pars</span><span class="op">$</span><span class="va">calN</span> <span class="op">&lt;-</span> <span class="va">calN</span></span>
<span></span>
<span><span class="co"># ITN coverage</span></span>
<span><span class="va">ITN_cov</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">t</span> <span class="op">/</span> <span class="fl">365</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">}</span></span>
<span></span>
<span><span class="co"># set parameters</span></span>
<span><span class="fu"><a href="../reference/make_parameters_exogenous_null.html">make_parameters_exogenous_null</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/make_parameters_vc_lemenach.html">make_parameters_vc_lemenach</a></span><span class="op">(</span><span class="va">pars</span>, phi <span class="op">=</span> <span class="va">ITN_cov</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/make_parameters_MYZ_RM_dde.html">make_parameters_MYZ_RM_dde</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="va">pars</span>, g <span class="op">=</span> <span class="va">g</span>, sigma <span class="op">=</span> <span class="va">sigma</span>, calK <span class="op">=</span> <span class="va">calK</span>, f <span class="op">=</span> <span class="va">f</span>, q <span class="op">=</span> <span class="va">q</span>, nu <span class="op">=</span> <span class="va">nu</span>, eggsPerBatch <span class="op">=</span> <span class="va">eggsPerBatch</span>, tau <span class="op">=</span> <span class="va">tau</span>, M0 <span class="op">=</span> <span class="va">M</span>, G0 <span class="op">=</span> <span class="va">G</span>, Y0 <span class="op">=</span> <span class="va">Y</span>, Z0 <span class="op">=</span> <span class="va">Z</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/make_parameters_L_basic.html">make_parameters_L_basic</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="va">pars</span>, psi <span class="op">=</span> <span class="va">psi</span>, phi <span class="op">=</span> <span class="va">phi</span>, theta <span class="op">=</span> <span class="va">theta</span>, L0 <span class="op">=</span> <span class="va">L</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/make_parameters_X_SIS.html">make_parameters_X_SIS</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="va">pars</span>, b <span class="op">=</span> <span class="va">b</span>, c <span class="op">=</span> <span class="va">c</span>, r <span class="op">=</span> <span class="va">r</span>, Psi <span class="op">=</span> <span class="va">Psi</span>, wf <span class="op">=</span> <span class="va">wf</span>, X0 <span class="op">=</span> <span class="va">X</span>, H <span class="op">=</span> <span class="va">H</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/make_indices.html">make_indices</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="va">pars</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="solve">Solve<a class="anchor" aria-label="anchor" href="#solve"></a>
</h2>
<p>After setting parameters we must set the initial conditions of the
model. Then we’re ready to solve the model! We integrate over a 5 year
interval, to show the effects of the “seasonal” ITN coverage.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ICs</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NaN</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">X_ix</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span><span class="op">[</span><span class="va">pars</span><span class="op">$</span><span class="va">L_ix</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">$</span><span class="va">Lpar</span><span class="op">$</span><span class="va">L0</span></span>
<span><span class="va">y</span><span class="op">[</span><span class="va">pars</span><span class="op">$</span><span class="va">X_ix</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">$</span><span class="va">Xpar</span><span class="op">$</span><span class="va">X0</span></span>
<span><span class="va">y</span><span class="op">[</span><span class="va">pars</span><span class="op">$</span><span class="va">M_ix</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">$</span><span class="va">MYZpar</span><span class="op">$</span><span class="va">M0</span></span>
<span><span class="va">y</span><span class="op">[</span><span class="va">pars</span><span class="op">$</span><span class="va">G_ix</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">$</span><span class="va">MYZpar</span><span class="op">$</span><span class="va">G0</span></span>
<span><span class="va">y</span><span class="op">[</span><span class="va">pars</span><span class="op">$</span><span class="va">Y_ix</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">$</span><span class="va">MYZpar</span><span class="op">$</span><span class="va">Y0</span></span>
<span><span class="va">y</span><span class="op">[</span><span class="va">pars</span><span class="op">$</span><span class="va">Z_ix</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">$</span><span class="va">MYZpar</span><span class="op">$</span><span class="va">Z0</span></span>
<span><span class="va">y</span><span class="op">[</span><span class="va">pars</span><span class="op">$</span><span class="va">Upsilon_ix</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">Upsilon</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># solve the model</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/dede.html" class="external-link">dede</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, times <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="fl">365</span><span class="op">*</span><span class="fl">5</span><span class="op">)</span>, func <span class="op">=</span> <span class="va">xDE_diffeqn</span>, parms <span class="op">=</span> <span class="va">pars</span><span class="op">)</span></span></code></pre></div>
<p>We can plot the output to study the effects of the seasonal ITN
coverage on the state variables. We see that total and parous mosquito
densities <span class="math inline">\(M\)</span> and <span class="math inline">\(G\)</span> now vary in a sinusoidal manner as
coverage changes, as does <span class="math inline">\(L\)</span>, larval
density, as the number of ovipositing mosquitoes changes. Because in
addition to increasing mosquito mortality, ITNs also decrease the
feeding rate and proportion of bloodmeals taken on humans due to the
repellency effect, we see the densities of infected and infectious
mosquitoes (<span class="math inline">\(Y\)</span> and <span class="math inline">\(Z\)</span>) steadily decrease over time as there
are no longer sufficient bloodmeals being taken to sustain prevalence. A
similar pattern appears in human prevalence <span class="math inline">\(X\)</span>, with slower dynamics due to the slow
recovery rate of untreated infection.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="va">pars</span><span class="op">$</span><span class="va">L_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'L_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">pars</span><span class="op">$</span><span class="va">nHabitats</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="va">pars</span><span class="op">$</span><span class="va">M_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'M_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="va">pars</span><span class="op">$</span><span class="va">G_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'G_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="va">pars</span><span class="op">$</span><span class="va">Y_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Y_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="va">pars</span><span class="op">$</span><span class="va">Z_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Z_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">pars</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="va">pars</span><span class="op">$</span><span class="va">X_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'X_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">pars</span><span class="op">$</span><span class="va">nStrata</span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">Upsilon_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">out</span>, id.vars <span class="op">=</span> <span class="st">'time'</span><span class="op">)</span></span>
<span><span class="va">out</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Component"</span>, <span class="st">"Stratification"</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/tstrsplit.html" class="external-link">tstrsplit</a></span><span class="op">(</span><span class="va">variable</span>, <span class="st">'_'</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">out</span><span class="op">[</span>, <span class="va">variable</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">out</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">Stratification</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">Component</span>, scales <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="vc_lemenach_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Sean L. Wu, David L. Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
