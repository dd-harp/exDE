<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="exDE">
<title>Spatial Metrics • exDE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spatial Metrics">
<meta property="og:description" content="exDE">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">exDE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ex_534.html">5-3-4 Spatial Example</a>
    <a class="dropdown-item" href="../articles/spat_metric.html">Spatial Metrics</a>
    <a class="dropdown-item" href="../articles/vc_lemenach.html">Vector Control Example</a>
    <a class="dropdown-item" href="../articles/Contributing.html">Contributing</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-adult-mosquito-component">Adult Mosquito Component</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-adult-mosquito-component">
    <a class="dropdown-item" href="../articles/adult_RM.html">Ross-Macdonald model</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-aquatic-mosquito-component">Aquatic Mosquito Component</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-aquatic-mosquito-component">
    <a class="dropdown-item" href="../articles/aqua_trace.html">Trace (forced) model</a>
    <a class="dropdown-item" href="../articles/aqua_basic.html">Basic competition model</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-human-component">Human Component</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-human-component">
    <a class="dropdown-item" href="../articles/human_sis.html">SIS model</a>
    <a class="dropdown-item" href="../articles/human_sip.html">SIP model</a>
    <a class="dropdown-item" href="../articles/human_hmoi.html">MoI hybrid model</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dd-harp/exDE/">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Spatial Metrics</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/exDE/blob/HEAD/vignettes/spat_metric.Rmd" class="external-link"><code>vignettes/spat_metric.Rmd</code></a></small>
      <div class="d-none name"><code>spat_metric.Rmd</code></div>
    </div>

    
    
<p>All state components are assumed to be column vectors. Additionally,
<span class="math inline">\(n\)</span> will always denote the number of
strata in the human population, <span class="math inline">\(l\)</span>
the number of aquatic habitats and <span class="math inline">\(p\)</span> the number of patches.</p>
<div class="section level3">
<h3 id="human-movement">Human Movement<a class="anchor" aria-label="anchor" href="#human-movement"></a>
</h3>
<p>We start with the fundamental matrix <span class="math inline">\(\Psi\)</span> which is of dimension <span class="math inline">\(p\times n\)</span> , where each column <span class="math inline">\(i\)</span> gives the distribution of time at risk
for that strata over places (rows). If all strata are considered to be
potentially at risk 100% of the time, then the columns will sum to one,
which is the convention we will adopt for this document.</p>
<p>Then <span class="math inline">\(\Psi_{ji}\)</span> is the fraction
of time that strata <span class="math inline">\(i\)</span> spends in
patch <span class="math inline">\(j\)</span>.</p>
</div>
<div class="section level3">
<h3 id="ambient-human-population">Ambient Human Population<a class="anchor" aria-label="anchor" href="#ambient-human-population"></a>
</h3>
<p>Let <span class="math inline">\(H\)</span> be a length <span class="math inline">\(n\)</span> column vector giving the population
size of each strata. Let <span class="math inline">\(w_{f}\)</span> be a
length <span class="math inline">\(n\)</span> column vector giving the
biting weights on each strata (the null value is <span class="math inline">\(1\)</span>). We want to know <span class="math inline">\(W\)</span>, a length <span class="math inline">\(p\)</span> column vector which tells us how many
people are at each patch (summing over all strata who are there).</p>
<p><span class="math display">\[
W =\begin{bmatrix}
\sum_{i} \Psi_{1i}w_{f1}H_{i} \\ \vdots \\ \sum_{i} \Psi_{pi}w_{fi}H_{i}
\end{bmatrix} = \Psi \cdot w_{f} H
\]</span> Each element of <span class="math inline">\(W\)</span> then
gives the total weighted person-time spent by all strata at that
location.</p>
</div>
<div class="section level3">
<h3 id="biting-distribution-matrix">Biting Distribution Matrix<a class="anchor" aria-label="anchor" href="#biting-distribution-matrix"></a>
</h3>
<p>The biting distribution matrix <span class="math inline">\(\beta\)</span> is a <span class="math inline">\(n
\times p\)</span> matrix which is central to formulating mathematically
consistent models of bloodfeeding, and, by extension, consistent models
of mosquito-borne pathogen transmission.</p>
<p>It is given mathematically as:</p>
<p><span class="math display">\[
\beta = \mbox{diag}(w_{f}) \cdot \Psi^{\top} \cdot \mbox{diag}(1/W)
\]</span></p>
<p>And it can be written out component-wise as:</p>
<p><span class="math display">\[
\beta = \begin{bmatrix}
\frac{\Psi_{11}w_{f1}}{\sum_{i}\Psi_{1i}w_{fi}H_{i}} &amp; \cdots &amp;
\frac{\Psi_{p1}w_{f1}}{\sum_{i}\Psi_{pi}w_{fi}H_{i}} \\
\vdots &amp; &amp; \vdots \\
\frac{\Psi_{1n}w_{fn}}{\sum_{i}\Psi_{1i}w_{fi}H_{i}} &amp; \cdots &amp;
\frac{\Psi_{pn}w_{fn}}{\sum_{i}\Psi_{pi}w_{fi}H_{i}}
\end{bmatrix}
\]</span></p>
<p>Now we can get a clearer impression of what <span class="math inline">\(\beta_{ij}\)</span> is. It is the probability a
bite from mosquitoes in patch <span class="math inline">\(j\)</span>
lands on any particular person in strata <span class="math inline">\(i\)</span>. Another way say this is that it is the
proportion of person-time spent by a single person in strata <span class="math inline">\(i\)</span> at patch <span class="math inline">\(j\)</span>, out of all person-time spent at that
patch.</p>
<p>If we wanted to look at a matrix whose columns sum to unity and
elements give the probability of a bite taken on the ambient population
in patch <span class="math inline">\(j\)</span> to land on strata <span class="math inline">\(i\)</span>, we could look at the following
matrix:</p>
<p><span class="math display">\[
\mbox{diag}(H) \cdot \beta
\]</span></p>
<p>This operation has the effect of multiplying each column in <span class="math inline">\(\beta\)</span> by the diagonal of of the matrix on
the left, so that the columns sum to one (or the column sums of <span class="math inline">\(\Psi\)</span>, in case the total time at risk is
<span class="math inline">\(&lt; 1\)</span>).</p>
<p>Likewise if we want to recover <span class="math inline">\(\Psi^{\top}\)</span>, a <span class="math inline">\(n \times p\)</span> matrix whose rows describe how
each strata distributes its time across patches, one can simply multiply
on the right by <span class="math inline">\(\mbox{diag}(W)\)</span>
which has the effect of multiplying each column of <span class="math inline">\(\beta\)</span> by that element of the diagonal of
<span class="math inline">\(\mbox{diag}(W)\)</span>.</p>
<p><span class="math display">\[
\beta \cdot \mbox{diag}(W)
\]</span></p>
</div>
<div class="section level3">
<h3 id="human-transmitting-capacity-htc">Human transmitting capacity (HTC)<a class="anchor" aria-label="anchor" href="#human-transmitting-capacity-htc"></a>
</h3>
<p>Human transmitting capacity is a vector <span class="math inline">\(D\)</span> of length <span class="math inline">\(n\)</span>, each element of which gives the number
of net infectious days for an infected individual in each strata. For
the homogeneous SIS model, it is simply:</p>
<p><span class="math display">\[
D = \frac{c}{r}
\]</span></p>
</div>
<div class="section level3">
<h3 id="parasite-dispersal-by-mosquitoes">Parasite dispersal by mosquitoes<a class="anchor" aria-label="anchor" href="#parasite-dispersal-by-mosquitoes"></a>
</h3>
<p>The parasite dispersal by mosquitoes matrix, <span class="math inline">\(\mathcal{V}\)</span> is the spatial analogue to
vectorial capacity, which is the expected number of humans infected per
infected human, per day, assuming perfect transmission efficiency.</p>
<p><span class="math display">\[
\mathcal{V} = fq\Omega^{-1} \cdot e^{-\Omega\tau} \cdot
\mbox{diag}\left(\frac{fqM}{W}\right)
\]</span> It can be understood by going from right to left. The matrix
<span class="math inline">\(\mbox{diag}\left(\frac{fqM}{W}\right)\)</span> is
a <span class="math inline">\(p\times p\)</span> matrix, the diagonal
giving the numbers of bloodmeals taken on each person in each patch, per
day. Multiplying on the left by <span class="math inline">\(e^{-\Omega\tau}\)</span> has the effect of
multiplying each column of the matrix on the left by the corresponding
element of the diagonal of the matrix on the right. That intermediate
matrix will have columns which describe how those bites/person from each
patch are distributed across other patches over the extrinsic incubation
period, accounting for mortality during that period. The final
multiplication on the left distributes those bites after the EIP has
passed.</p>
<p>If we only have a single patch, the formula becomes:</p>
<p><span class="math display">\[
\frac{fq}{g} e^{-g\tau}fq\frac{M}{H}
\]</span> Which is equivalent to (after substituting <span class="math inline">\(H=W\)</span>) the classic formula from <a href="https://malariajournal.biomedcentral.com/articles/10.1186/1475-2875-3-13" class="external-link">Smith
and McKenzie (2004)</a>: <span class="math inline">\(\frac{fq}{g}e^{-g\tau}fq\frac{M}{H}\)</span>.</p>
</div>
<div class="section level3">
<h3 id="parasite-dispersal-by-humans">Parasite dispersal by humans<a class="anchor" aria-label="anchor" href="#parasite-dispersal-by-humans"></a>
</h3>
<p><span class="math display">\[
\mathcal{D} = \mbox{diag}\left(W \right) \cdot \beta^T \cdot
\mbox{diag}\left(bDH\right) \cdot \beta
\]</span> We can first examine the multiplication of <span class="math inline">\(\mbox{diag}\left(bDH\right) \cdot \beta\)</span>
on the right. This has the effect of multiplying each column of <span class="math inline">\(\beta\)</span> by the diagonal of <span class="math inline">\(\mbox{diag}\left(bDH\right)\)</span>. This results
in a <span class="math inline">\(n\times p\)</span> matrix whose columns
give the distribution of potentially transmitting person-time (<span class="math inline">\(\frac{bc}{r}\)</span>) a person in each strata
contributes to a patch. It is a <span class="math inline">\(p\times
p\)</span> matrix.</p>
<p>On the left <span class="math inline">\(\mbox{diag}\left(W \right)
\cdot \beta^T\)</span> multiplies each column of <span class="math inline">\(\beta^T\)</span> by the diagonal of that matrix;
this has the effect of recovering the original movement matrix <span class="math inline">\(\Psi\)</span>. So multiplying the intermediate
matrix produced by the preceding section by this on the left distributes
that potentially-transmitting person time across patches. Therefore
<span class="math inline">\(i\)</span>-th column of <span class="math inline">\(\mathcal{D}\)</span> describes how potentially
infectious person-time from a person infected in <span class="math inline">\(i\)</span> is distributed across other
patches.</p>
<p>In the 1 patch, 1 strata case, it simplifies considerably to:</p>
<p><span class="math display">\[
\mathcal{D} = \frac{bc}{r}
\]</span></p>
</div>
<div class="section level3">
<h3 id="parasite-dispersal-through-one-parasite-generation">Parasite Dispersal through one Parasite Generation<a class="anchor" aria-label="anchor" href="#parasite-dispersal-through-one-parasite-generation"></a>
</h3>
<p>One way to look at parasite dispersal is to look at how parasites are
dispersed through one parasite generation. This can be done with from
mosquito to mosquito, or human to human. Below we show the equation for
parasite dispersal through a generation, beginning and ending with a
human host.</p>
<p><span class="math display">\[
\mathcal{R} =   b \beta \cdot {\cal V}  \cdot \mbox{diag}\left(W \right)
\cdot \beta^T  \cdot \mbox{diag}\left(DH\right)
\]</span></p>
<p>Here <span class="math inline">\(\mathcal{R}\)</span> is a <span class="math inline">\(n\times n\)</span> matrix, the columns of which
describe how infections starting in that strata are disseminated among
other strata after one generation. Once again we can learn how to
interpret the equation by walking from left to right. <span class="math inline">\(\mbox{diag}\left(W \right) \cdot \beta^T \cdot
\mbox{diag}\left(DH\right)\)</span> produces a <span class="math inline">\(p\times n\)</span> matrix which describes how
infectious person-time in each strata is spread across patches.
Multiplication by <span class="math inline">\(\mathcal{V}\)</span> then
describes how this infectious person-time is transformed into
potentially infectious bites by mosquitoes, distributed over space and
accounting for mortality during the EIP. Final multiplication by <span class="math inline">\(\beta\)</span> and <span class="math inline">\(b\)</span> takes into account where persons will
contact those infectious bites, and the transmission efficiency back to
human hosts.</p>
<p>Once again, we can take the 1 patch, 1 strata case to see how this
formula simplifies:</p>
<p><span class="math display">\[
\frac{bc}{r} \cdot \frac{fq}{g} e^{-g\tau}fq\frac{M}{H}
\]</span></p>
<p>Which is precisely the formula for <span class="math inline">\(R_{0}\)</span> in <a href="https://malariajournal.biomedcentral.com/articles/10.1186/1475-2875-3-13" class="external-link">Smith
and McKenzie (2004)</a>. Therefore <span class="math inline">\(\mathcal{R}\)</span> is the “logical” spatial
version of this threshold metric.</p>
<p>If we track parasite dispersal from mosquitoes to mosquitoes we
arrive at the <span class="math inline">\(p\times p\)</span> matrix:</p>
<p><span class="math display">\[
\mathcal{Z} = e^{-\Omega\tau} \cdot \mbox{diag}\left( \frac{fq M}{W}
\right) \cdot {\cal D} \cdot  fq\Omega^{-1}
\]</span> In the 1 patch 1 strata case this becomes the same equation as
<span class="math inline">\(\mathcal{R}\)</span>.</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dd-harp.github.io/exDE/">exDE</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>Here we demonstrate how to calculate these metrics using the <a href="ex_534.html">5-3-4 example</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span></span>
<span><span class="va">calN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,</span>
<span>           <span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,</span>
<span>           <span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, </span>
<span>  nrow <span class="op">=</span> <span class="va">p</span>, ncol <span class="op">=</span> <span class="va">l</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">xi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.7</span>, <span class="fl">.2</span>, <span class="fl">.1</span>, <span class="fl">.8</span>, <span class="fl">.2</span><span class="op">)</span>, <span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span> </span>
<span><span class="va">calU</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">calN</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">xi</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">12</span>, <span class="va">p</span><span class="op">)</span> </span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">12</span><span class="op">/</span><span class="fl">2</span>, <span class="va">p</span><span class="op">)</span> </span>
<span><span class="va">calK</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.6</span>, <span class="fl">.3</span><span class="op">)</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.4</span>, <span class="fl">0</span>, <span class="fl">.7</span><span class="op">)</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.6</span>, <span class="fl">.4</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, <span class="va">p</span><span class="op">)</span> </span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="va">p</span><span class="op">)</span> </span>
<span><span class="va">tau</span> <span class="op">&lt;-</span> <span class="fl">12</span> </span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Omega</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">p</span><span class="op">)</span><span class="op">-</span><span class="va">calK</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span></span>
<span><span class="va">Lambda</span> <span class="op">&lt;-</span> <span class="va">Omega</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">M</span></span>
<span></span>
<span><span class="va">H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">90</span>, <span class="fl">100</span>, <span class="fl">900</span><span class="op">)</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">*</span><span class="va">H</span><span class="op">)</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">200</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.55</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">.02</span>, <span class="fl">.1</span>, <span class="fl">.02</span><span class="op">)</span></span>
<span></span>
<span><span class="va">calJ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">p</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.001</span>,<span class="fl">0.001</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.95</span>,<span class="fl">.92</span>,<span class="fl">.04</span>,<span class="fl">.02</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.04</span>,<span class="fl">.02</span>,<span class="fl">.959</span>,<span class="fl">.929</span><span class="op">)</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">p</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="va">Theta</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">H</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Theta</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="../reference/diag_inverse.html">diag_inverse</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span></span>
<span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="va">c</span><span class="op">/</span><span class="va">r</span></span>
<span></span>
<span><span class="va">calV</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metric_calV.html">metric_calV</a></span><span class="op">(</span>f <span class="op">=</span> <span class="va">f</span>, q <span class="op">=</span> <span class="va">q</span>, Omega <span class="op">=</span> <span class="va">Omega</span>, tau <span class="op">=</span> <span class="va">tau</span>, M <span class="op">=</span> <span class="va">M</span>, W <span class="op">=</span> <span class="va">W</span><span class="op">)</span></span>
<span><span class="va">calD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metric_calD.html">metric_calD</a></span><span class="op">(</span>W <span class="op">=</span> <span class="va">W</span>, beta <span class="op">=</span> <span class="va">beta</span>, b <span class="op">=</span> <span class="va">b</span>, D <span class="op">=</span> <span class="va">D</span>, H <span class="op">=</span> <span class="va">H</span><span class="op">)</span></span>
<span><span class="va">calR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metric_calR.html">metric_calR</a></span><span class="op">(</span>b <span class="op">=</span> <span class="va">b</span>, beta <span class="op">=</span> <span class="va">beta</span>, calV <span class="op">=</span> <span class="va">calV</span>, W <span class="op">=</span> <span class="va">W</span>, D <span class="op">=</span> <span class="va">D</span>, H <span class="op">=</span> <span class="va">H</span><span class="op">)</span></span>
<span><span class="va">calZ</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metric_calZ.html">metric_calZ</a></span><span class="op">(</span>Omega <span class="op">=</span> <span class="va">Omega</span>, tau <span class="op">=</span> <span class="va">tau</span>, f <span class="op">=</span> <span class="va">f</span>, q <span class="op">=</span> <span class="va">q</span>, M <span class="op">=</span> <span class="va">M</span>, W <span class="op">=</span> <span class="va">W</span>, calD <span class="op">=</span> <span class="va">calD</span><span class="op">)</span></span></code></pre></div>
<p>We can visualize the matrices as heatmaps.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calV_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">calV</span><span class="op">)</span>,</span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">calV</span><span class="op">)</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">calV</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">calV</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">calV</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">calV_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">y</span>,fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_reverse</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="spat_metric_files/figure-html/unnamed-chunk-4-1.png" width="100%"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Sean L. Wu, David L. Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
