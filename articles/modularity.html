<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="exDE">
<title>Modular Forms for Disease Dynamics â€¢ exDE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Modular Forms for Disease Dynamics">
<meta property="og:description" content="exDE">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">exDE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Understanding_exDE.html">Understanding exDE</a>
    <a class="dropdown-item" href="../articles/modularity.html">Modular Forms for Disease Dynamics</a>
    <a class="dropdown-item" href="../articles/ex_534.html">5-3-4 Spatial Example</a>
    <a class="dropdown-item" href="../articles/spat_metric.html">Spatial Metrics</a>
    <a class="dropdown-item" href="../articles/vc_lemenach.html">Vector Control Example</a>
    <a class="dropdown-item" href="../articles/Contributing.html">Contributing</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-adult-mosquito-dynamics">Adult Mosquito Dynamics</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-adult-mosquito-dynamics">
    <a class="dropdown-item" href="../articles/adult_RM.html">Ross-Macdonald model</a>
    <a class="dropdown-item" href="../articles/adult_GeRM.html">Generalized Ross-Macdonald model</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-aquatic-mosquito-dynamics">Aquatic Mosquito Dynamics</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-aquatic-mosquito-dynamics">
    <a class="dropdown-item" href="../articles/aqua_trace.html">Trace (forced) model</a>
    <a class="dropdown-item" href="../articles/aqua_basic.html">Basic competition model</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-human-infection-dynamics">Human Infection Dynamics</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-human-infection-dynamics">
    <a class="dropdown-item" href="../articles/human_sis.html">SIS model</a>
    <a class="dropdown-item" href="../articles/human_sip.html">SIP model</a>
    <a class="dropdown-item" href="../articles/human_hmoi.html">MoI hybrid model</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dd-harp/exDE/">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Modular Forms for Disease Dynamics</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/exDE/blob/HEAD/vignettes/modularity.Rmd" class="external-link"><code>vignettes/modularity.Rmd</code></a></small>
      <div class="d-none name"><code>modularity.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><strong>Modular forms</strong> for disease dynamics are stylized ways
of writing the dynamical systems that emphasize their modular structure.
A mathematical framework for building models of malaria dynamics and
control (and other mosquito-borne pathogens) was described in <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1010684" target="_blank" class="external-link">Spatial Dynamics of Malaria Transmission</a>, and the
framework was implemented in <code>exDE.</code> The forms we describe
here rewrite models so that they closely resemble their implementation
in <code>exDE</code>, which makes it possible to relate written
equations and computed code. (Also, see the closely related vignette <a href="Understanding_exDE.html" target="_blank">Understanding
exDE</a>.)</p>
</div>
<div class="section level2">
<h2 id="the-modular-form">The Modular Form<a class="anchor" aria-label="anchor" href="#the-modular-form"></a>
</h2>
<p>We illustrate by writing a Ross-Macdonald model in its modular form
(Figure 1). In its classical form, this is the model:</p>
<p><span class="math display">\[ \begin{array}{rl}
dX/dt &amp;= b e^{-gn}fq \frac YH (H-X) - r X \\
dY/dt &amp;= a c \frac XH (M-Y) - g Y
\end{array}\]</span></p>
<p>The model is explained below.</p>
<hr>
<div class="figure">
<img src="RossMacdonald3b.png" alt=""><p class="caption"><strong>Figure 1</strong> - Diagram of a
Ross-Macdonald model as it is written in its modular form.</p>
</div>
<hr>
<div class="section level3">
<h3 id="parasite-infection-dynamics-in-humans-cal-x">Parasite Infection Dynamics in Humans, <span class="math inline">\(\cal X\)</span><a class="anchor" aria-label="anchor" href="#parasite-infection-dynamics-in-humans-cal-x"></a>
</h3>
<p>The equation describing human infections is written in the following
way:</p>
<p><span class="math display">\[
dI/dt = h (H-I) - r I
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(I\)</span> is the density of infected
and infectious humans;</p></li>
<li><p><span class="math inline">\(H\)</span> is the density of
humans;</p></li>
<li><p><span class="math inline">\(h\)</span> is the force of infection
(FoI), the number of infections, per perspon, per day; it is related to
the daily entomological inoculation rate (dEIR).</p></li>
<li><p><span class="math inline">\(r\)</span> is the clearance rate, the
number of infections that clear, per infected person, per day.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="parasite-infection-dynamics-in-mosquitoes-cal-yz">Parasite Infection Dynamics in Mosquitoes, <span class="math inline">\(\cal YZ\)</span><a class="anchor" aria-label="anchor" href="#parasite-infection-dynamics-in-mosquitoes-cal-yz"></a>
</h3>
<p>Similarly, the equation describing infected mosquitoes is the
following:</p>
<p><span class="math display">\[
dY/dt = a\kappa (M-Y) - g Y
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(Y\)</span> is the density of infected
mosquitoes;</p></li>
<li><p><span class="math inline">\(M\)</span> is the density of
mosquitoes;</p></li>
<li><p><span class="math inline">\(f\)</span> is the overall mosquito
blood feeding rate, the number of human blood meals, per mosquito, per
day;</p></li>
<li><p><span class="math inline">\(q\)</span> is the human fraction;
human blood feeding as a fraction of all blood feeding;</p></li>
<li><p><span class="math inline">\(\kappa\)</span> is the net
infectiousness (NI) of humans, the probability a mosquito would become
infected after blood feeding on a human; it is related to the density of
infected humans.</p></li>
<li><p><span class="math inline">\(g\)</span> is the mosquito death
rate, the number of mosquitoes dying, per mosquito, per day;</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="blood-feeding">Blood Feeding<a class="anchor" aria-label="anchor" href="#blood-feeding"></a>
</h3>
<p>There are two <strong>terms,</strong> the FoI (<span class="math inline">\(h\)</span>) and the NI (<span class="math inline">\(\kappa\)</span>), in the equations above that rely
on information that comes from the other equation. To compute them, we
need a construct to deal with the concept of <em>mixing,</em> which we
will denote <span class="math inline">\(\beta\)</span>. In the generic
form, the computation of these terms defines the blood feeding model,
which is the interface between <span class="math inline">\(\cal
YZ\)</span> and <span class="math inline">\(\cal X.\)</span></p>
<div class="section level4">
<h4 id="force-of-infection-foi">Force of Infection (FoI)<a class="anchor" aria-label="anchor" href="#force-of-infection-foi"></a>
</h4>
<p>The FoI <span class="math inline">\(h\)</span> must be related to the
density of infected mosquitoes. We compute this in several steps. First,
in this Ross-Macdonald model, the density of blood feeding mosquitoes is
given by a formula: <span class="math display">\[Z = F_Z(Y) = e^{-gn}
Y\]</span> where <span class="math inline">\(n\)</span> is the extrinsic
incubation period (EIP)</p>
<p>Next, we need to compute the EIR, which is computed by distributing
the infective bites among the humans. In this model, mixing is uniform
so <span class="math inline">\(\beta = 1/H\)</span>, and we write:</p>
<p><span class="math display">\[ E = \beta \cdot fqZ = \frac
{fqZ}H\]</span> and finally, we must compute the FoI, which could draws
information from many different sources,</p>
<p><span class="math display">\[ h = F_h(E, ...) = b E.\]</span></p>
<p>where <span class="math inline">\(b\)</span> is the fraction of
infective bites that cause an infection;</p>
</div>
<div class="section level4">
<h4 id="net-infectiousness-ni">Net Infectiousness (NI)<a class="anchor" aria-label="anchor" href="#net-infectiousness-ni"></a>
</h4>
<p>The NI <span class="math inline">\(\kappa\)</span> must be related to
the density of infected humans. In the Ross-Macdonald model, the
effective density of infected humans is:</p>
<p><span class="math display">\[X = F_X(I) = cI\]</span> where <span class="math inline">\(c\)</span> is the probability a mosquito would
become infected after blood feeding on an infected human.</p>
<p>The net infectiousness is computed as the infective density averaged
over biting among the humans. For reasons that will become clear later,
we call this <span class="math inline">\(\beta^T = 1/H\)</span>:</p>
<p><span class="math display">\[\kappa =  \beta^T \cdot X = \frac
XH\]</span></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="computation">Computation<a class="anchor" aria-label="anchor" href="#computation"></a>
</h2>
<p>To solve these equations, we need to write functions that compute the
derivatives. We are using the R package <code>deSolve</code>, so the
derivative function would have a constrained form:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RMv1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span>,<span class="op">{</span></span>
<span>      <span class="va">foi</span> <span class="op">=</span> <span class="va">b</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">g</span><span class="op">*</span><span class="va">n</span><span class="op">)</span><span class="op">*</span><span class="va">Y</span><span class="op">/</span><span class="va">H</span></span>
<span>      <span class="va">kappa</span> <span class="op">=</span> <span class="va">c</span><span class="op">*</span><span class="va">I</span><span class="op">/</span><span class="va">H</span></span>
<span>      <span class="va">dX</span> <span class="op">=</span> <span class="va">foi</span><span class="op">*</span><span class="op">(</span><span class="va">H</span><span class="op">-</span><span class="va">I</span><span class="op">)</span> <span class="op">-</span> <span class="va">r</span><span class="op">*</span><span class="va">I</span></span>
<span>      <span class="va">dY</span> <span class="op">=</span> <span class="va">a</span><span class="op">*</span><span class="va">kappa</span><span class="op">*</span><span class="op">(</span><span class="va">M</span><span class="op">-</span><span class="va">Y</span><span class="op">)</span> <span class="op">-</span> <span class="va">g</span><span class="op">*</span><span class="va">Y</span> </span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">dX</span>, <span class="va">dY</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In <code>exDE,</code> the equations are solved by computing the terms
and the derivatives separately.</p>
<ul>
<li>
<p><code>Transmission(t,y,pars)</code> computes three terms required
to compute parasite transmission during blood feeding. These are stored
in the main model object <code>pars</code>:</p>
<ul>
<li><p><code>pars$beta</code></p></li>
<li><p><code>pars$EIR</code></p></li>
<li><p><code>pars$NI</code></p></li>
</ul>
</li>
<li><p><code>Exposure(t, y, pars)</code> computes the FoI from the EIR
under a model of exposure and stores it as
<code>pars$FoI</code></p></li>
</ul>
<p>So instead of developing models like <code>RMv1</code>, we have
implemented the code in the syle of <code>RMv2</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RMv2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span>,<span class="op">{</span></span>
<span>      <span class="va">pars</span> <span class="op">=</span> <span class="fu"><a href="../reference/Transmission.html">Transmission</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span><span class="op">)</span></span>
<span>      <span class="va">pars</span> <span class="op">=</span> <span class="fu"><a href="../reference/Exposure.html">Exposure</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span><span class="op">)</span></span>
<span>      <span class="va">dX</span> <span class="op">=</span> <span class="fu"><a href="../reference/dXdt.html">dXdt</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span><span class="op">)</span> </span>
<span>      <span class="va">dY</span> <span class="op">=</span> <span class="fu"><a href="../reference/dMYZdt.html">dMYZdt</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span><span class="op">)</span> </span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">dX</span>, <span class="va">dY</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="full-modularity">Full Modularity<a class="anchor" aria-label="anchor" href="#full-modularity"></a>
</h2>
<p>The full structure of computation in <code>exDE</code> is diagrammed
in <em>Figure 2</em> and easily examined in the corresponding code. One
advantage of the modular notation is that it is possible to set up and
describe reasonably complex models with fairly simple scripts. The
vignette <a href="ex_534.html">5-3-4 Example</a> shows how this
works.</p>
<hr>
<div class="figure">
<img src="RossMacdonald4.png" alt=""><p class="caption">Figure 2</p>
</div>
<hr>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Sean L. Wu, David L. Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
