---
title: "Contributing"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Contributing}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

Thank you for taking the time to contribute to **exDE** (Extensible Differential Equations for mosquito-borne pathogen modeling). In this document we will explain the following topics:

  1. What is our Git workflow?
  2. How is the R package organized?
  3. If I am making a large addition (e.g. a new human disease model), what should I add to the package?
  4. After making changes locally, how to rebuild the package and run tests?
  5. How to make a good pull request (PR), and how should reviewers review pull requests?
  6. If the GitHub continuous integration (CI) tests fail, how to diagnose the problems and address them?
  7. How to get ready for a version update (for core dev team)?
  8. If I find a bug or something I just can't figure out, how to ask for help?
  
This document is intended to be a complete guide on how to get started developing with **exDE**. As this document is part of the package, if you find something about it incorrect, baffling, or just have a suggestion, please follow the steps for bug/issue reporting to let us know!

## 1. Git workflow {#sec1}

The **exDE** project is hosted on GitHub ([at this repository](https://github.com/dd-harp/exDE)), and we use a Git workflow based loosely on "Gitflow", described in great detail [here](https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow). A Git workflow is a way to use the repository in such a way to invite collaboration in an organized way that protects the latest stable version of the software from unintended changes.

Our workflow is designed around branches. The `main`, `dev`, and `gh-pages` branches always exist in the repository. Other branches exist as long as the person(s) working on them need them, and should be deleted after they have been merged into `dev`.

  * `main`: this is the branch that contains the latest version release of **exDE**, and when it is updated the [CRAN version](https://cran.r-project.org/package=exDE) will also be updated. PRs should not be submitted to it except by the core dev team, as updated to `main` will mean we need to update the package on CRAN and do various other housekeeping tasks to accompany a version update (i.e. create an archival [release](https://github.com/dd-harp/exDE/releases) once the update is accepted by CRAN).
  * `dev`: this is the branch that all PRs from collaborators should be made to. The version of the code at `dev` should always be useable (i.e. pass all automated tests), and will contain the latest cutting edge features. Periodically when `dev` has accumulated a sufficient number of new features, a member of the core dev team will make a PR from `dev` into `main`. Because after `main` is updated we will update the CRAN package, these should not be too often, as CRAN themselves request that package maintainers submit updates ["no more than every 1â€“2 months"](https://cran.r-project.org/web/packages/policies.html#Submission).
  * `gh-pages`: this branch exists to support our GitHub pages website (the one you are browsing right now). It is updated automatically by our [pkgdown continuous integration workflow](https://github.com/dd-harp/exDE/blob/main/.github/workflows/pkgdown.yaml) which rebuilds the website when `main` is pushed to (i.e. when a PR is merged into `main`). `gh-pages` should be considered a "read-only" branch, even for the core dev team.
  * `feat/*`: branches starting with `feat/` should be how collaborators (and core dev) names branches which are updating or including new features, including but not limited to code, documentation, or tests. For example, a branch which improved documentation for this document could be called `feat/UpdateContributing`. After the PR from a `feat/` branch is merged into `dev`, that `feat/` branch should be deleted. PRs should never be made from `feat/` branches into `main`.
  * `bugfix/*`: for small bugfixes (spelling errors, misnamed variables, etc), it may be appropriate to make a `bugfix/` branch. The same rules apply to these as for `feat/` branches.
  
Some of our branches use [GitHub's branch protection rules](https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/defining-the-mergeability-of-pull-requests/about-protected-branches) to enforce these rules. Core dev team members can access these by going to Settings -> Branches. Both `main` and `dev` are protected from deletion. PRs made to `dev` must be reviewed and approved by at least 1 reviewer before they are allowed to be merged.

### Example

Let's say you have a great idea for a new feature, which is a change to improve this document. Here's how you would get started with our Git workflow to get your feature on the road to being merged into the **exDE** software.

Please note, we assume some familiarity with Git commands here. For a reference on the meaning of these commands, please see the [Git documentation](https://git-scm.com/docs).

  1. To start to work on **exDE**, you should first clone the repository. In a terminal window, navigate to the directory you want the `exDE` folder to appear in, and then run `git clone git@github.com:dd-harp/exDE.git`, if you use SSH keys, or `git clone https://github.com/dd-harp/exDE.git` to clone with HTTPS. These links can be found if you click the green "Code" button from the [main repository page](https://github.com/dd-harp/exDE).
  2. Once you clone the repository, go inside it with `cd exDE`. Then run `git fetch --all` which retrieves information about all the branches on the remote (the repository on the GitHub website) into your local repository (the one on your computer).
  3. Now you will switch to the `dev` branch by doing `git checkout dev`. You can make sure it's up to date by running `git pull origin dev`.
  4. Let's say you want to call your new feature branch `feat/UpdateContributing`. You can make it and switch to it by running `git checkout -b feat/UpdateContributing`.
  5. To push this new branch to the remote repository, run `git push origin feat/UpdateContributing`. It will now appear in the [list of branches](https://github.com/dd-harp/exDE/branches).
  6. Now, make your changes!
  7. Once you are ready to push your changes, use `git add` to either add files to a commit one by one, or if you know you want to add all new and/or modified files, you can use `git add .`.
  8. Run `git commit -m "your message explaining what these changes do"` to make a commit with a message. We do not mind many small commits, so if that is your Git style, please do not feel pressure to only make large commits.
  9. Now `git push origin feat/UpdateContributing` to push the commit to the remote branch `feat/UpdateContributing`! If you navigate to that branch on the GitHub repository, you should see your changes.
  
Now repeat steps 6 to 9 until you are ready to start testing your changes and submit a pull request (covered in Sections [4](#sec4) and [5](#sec5)).

## 2. The **exDE** R package {#sec2}

Code organization, whats auto-generated, whats part of pkgdown, etc

## 3. How to make large changes {#sec3}

tests vignettes, etc

## 4. How to test locally {#sec4}

How to use testthat and devtools

## 5. How to make or review a pull request {#sec5}

Stress that a PR can be a collaborative process...if you think your idea ought to work and would be a great addition to the package, its ok if you cant get it to work locally, make a PR and ask for help from other persons on the team.

## 6. How to deal with continuous integration {#sec6}

## 7. How to get ready for a version update {#sec7}

update DESCRIPTION version, how to submit to CRAN, check that pkgdown website worked, etc.

## 8. How to report bugs or raise issues? {#sec8}







## Issues

If you find a bug, have a question about how to use a feature that does not have sufficient documentation, or have a suggestion for improvement, please [leave an issue](https://github.com/dd-harp/exDE/issues) at our GitHub repo.

For bug reports please include:

 * **exDE** version
 * Operating System
 * R version
 * Steps to recreate
 * Expected behaviour
 * Actual behaviour

## Git

We use Git on this project. Which means we use `main`, `dev`, `feat/*`, `bug/*`, and `hotfix/*` branches. Please refer to [this post](https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow) for more information of each type of branch. 

  * `main`: this branch always stores the last "production" release of the software, and is a protected branch. A pull request should
  not be submitted to `main` unless it is from `dev`, meaning that the software version should be updated.
  * `dev`: all pull requests from users should be made to the `dev` branch. This branch is protected from deletion.
  * `feat`: new and significantly enhanced features are made in `feat` branches before being merged with `dev`. After a `feat/*` branch is merged
  with `dev`, it can be deleted.
  * `bug`: these branches fix bugs, usually after being raised as an issue. After a `bug/*` branch is merged with `dev`, it can be deleted.
  * `hotfix`: the difference between a `bug/*` and `hotfix/*` branch is `hotfix` is for small quick fixes (misspellings, incorrect arguments, etc.)
  and are short-lived. After being merged with `dev`, they can be deleted.

We periodically merge `dev` into `main` for release updates. These releases will appear on the [GitHub releases page](https://github.com/dd-harp/exDE/releases). 

## Continuous integration

We use GitHub Actions as our continuous integration platform to run workflows.
The workflows we use are from [r-lib/actions](https://github.com/r-lib/actions)
for R packages.

We run three types of workflows.

[R CMD check](https://github.com/r-lib/actions/blob/master/examples/check-standard.yaml)
runs during any pull request to `[main, dev]` branches.

[Test coverage](https://github.com/r-lib/actions/blob/master/examples/test-coverage.yaml)
runs during pushes to `[main]` and uses our [codecov.io integration](https://app.codecov.io/gh/dd-harp/MicroMoB)
for checking test coverage.

Finally, [pkgdown](https://github.com/r-lib/actions/blob/master/examples/pkgdown.yaml)
runs during pushes to `[main]`.

Please note that sometimes hard to diagnose bugs can be due to out of date
workflows. If you find a strange or unusual bug coming from a workflow, this
is something to consider checking.

## Pull Requests

If making a pull request, please only use `dev` as the base branch. If you are adding a new feature (i.e. the pull is from a `feat/*` branch),
please ensure you have added minimal tests using testthat so that the functionality of your feature can be tested.
